@using POC.Helper
@using POC.Models

@model POC.Models.Chat
@{
    var username = Extensions.GetLoggedInUserName();
}

<!--Script references. -->
<!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
<!--Reference the SignalR library. -->
<script src="~/Scripts/jquery.signalR-2.2.0.js"></script>
<!--Reference the autogenerated SignalR hub script. *REFERENCE TO PROXY FILE* -->
<script src="~/signalr/hubs"></script>
<!--SignalR script to update the chat page and send messages.-->
<div class="container">
    <div id="UserList">
        @Html.Partial("~/Views/Chat/UserList.cshtml", Model.Users)
    </div>
    <div>
        <input type="button" id="startchat" class="btn btn-primary" value="Start Chat"/>
    </div>
    <div>
        @{
            var chatHistory = Extensions.ChatHistory;
            <select class="form-control" id="chathistory" multiple="" name="chathistory">
                @foreach (var item in chatHistory) {
                    <option data-roomid="@item.RoomId"
                            data-users="@item.Participants+';'+@item.UserNameWhoStarted"
                            data-userwhostartedchat="@item.UserNameWhoStarted"
                            value="@item.RoomId">
                        @item.ChatStart.ToShortDateString() @item.ChatStart.ToShortTimeString() @item.Participants;@item.UserNameWhoStarted
                    </option>
                }
            </select>
            <input type="button" id="rejoin" class="btn btn-default" value="Rejoin Chat" />


        } 
    </div>
</div>


<script type="text/javascript">
    $(document).ready(function () {
        sentientPOC.chat.initialize("@username");
    });
</script>

